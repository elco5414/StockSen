<%- include ('../partials/head') %>
<%- include ('../partials/menu') %>

<style>
    body {
      background-color: black;
      color: green;
    }

    header, main, footer {
      padding: 20px;
    }

    .form-group {
      margin-bottom: 20px; /* Add margin between form groups */
    }

    input[type="password"],
    input[type="submit"] {
      border: 1px solid #ccc; /* Add a border to input elements */
      border-radius: 4px; /* Add border-radius for a rounded appearance */
    }
    input[type="password"] {
      width: calc(100% - 16px);
      padding: 8px;
      box-sizing: border-box;
    }
  
    input[type="submit"] {
      width: 100%;
      padding: 10px;
      background-color: #4CAF50; /* Green background color for submit button */
      color: #fff; /* White text color for submit button */
      cursor: pointer;
    }
  
    a{
      color: #4CAF50; /* Green color for links */
    }

    .card {
        background-color: black;
        color: white; /* Set text color to white for better visibility on black background */
        padding: 20px;
        float: left;
    }

    .card h2{
        color: green;
    }

    .card p{
        font-size: 18px; 
    }

    .container{
        background-color: black;
        float: right;
    }

    .card {
        background-color: black;
        color: white; /* Set text color to white for better visibility on black background */
        padding: 20px;
        float: left;
    }

</style>

<head>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<main>
    <h1><%= user.username %>'s Account</h1>
        <section>

            <div class="card">
                <h2>Investment Portfolio</h2>
                <p>Account Balance: $ <%= accountBalance %></p>
                <canvas id="accountBalanceChart"></canvas>
            </div>

            <div class="container">
                <form action="/change_password" method="POST">
            
                    <div class="form-group">
                        <label style="font-size:20px; text-align:center; margin-bottom:20px; color: green; text-transform: uppercase; letter-spacing: 2px;">Change Password</label>
                    </div>
                
                    <div class="form-group">
                        <label for="password">New Password</label>
                        <input type="password" id="password" name="password" style="width: calc(100% - 16px); padding: 8px; box-sizing: border-box; margin-bottom: 25px;" />
                    </div>
                    
                    <div class="form-group">
                        <input type="submit" value="Change Password" />
                    </div>

                    <div class="card2">
                      <h2>Latest Transactions</h2>
                      <ul id="latestTransactions"></ul>
                    </div>
                </form>
            </div>            
                    
        </section>
</main>
<script>
  // Function to fetch and display the latest transactions
  async function displayLatestTransactions() {
      try {
          const response = await fetch('/transactions');
          const transactions = await response.json();

          // Extract the latest three transactions
          const latestTransactions = transactions.slice(0, 3);

          // Get the element where you want to display the transactions
          const transactionsList = document.getElementById('latestTransactions');

          // Update the HTML content with the latest transactions
          latestTransactions.forEach(transaction => {
              const listItem = document.createElement('li');
              listItem.textContent = `Transaction ID: ${transaction.transaction_id}, Type: ${transaction.transaction_type}, Amount: $${transaction.transaction_price}`;
              transactionsList.appendChild(listItem);
          });

      } catch (error) {
          console.error('Error fetching latest transactions:', error);
      }
  }


  displayLatestTransactions();

  function initializeChart(accountBalance) {
        const ctx = document.getElementById('accountBalanceChart').getContext('2d');

        const etfBalance = 50000;
        const stocksBalance = 50000;
        const cashBalance = 50000;

        /*
        const etfBalance = 0;
        const stocksBalance = currentIndex * currentAmount;
        const cashBalance = 50000 - etfBalance - stocksBalance;
        */

        const data = {
            labels: [
                'Cash',
                'ETF',
                'Stocks'
            ],
            datasets: [{
                width: "10px",
                height: "10px",
                label: 'Current balance : ',
                data: [cashBalance, etfBalance, stocksBalance],
                backgroundColor: ['pink', 'purple', 'cyan'], 
                borderradius: 10, /* Optional: Add border-radius for rounded corners */
                borderWidth: 5,
                weight: 2,
                rotation: 1,
                spacing: 1
            }]
        };

        const options = {
            cutout: '70%', 
            aspectRatio : 0.8,
            legend: {
                display: false
            },
            tooltips: {
                enabled: false
            },
        };

        const pieDonutChart = new Chart(ctx, {
            type: 'doughnut',
            data: data,
            options: options
        });
    }

    initializeChart(<%= accountBalance %>); 

</script>

<script>
  // Function to fetch and display the latest transactions
  async function displayLatestTransactions() {
      try {
          const response = await fetch('/transactions');
          const transactions = await response.json();

          // Extract the latest three transactions
          const latestTransactions = transactions.slice(0, 3);

          // Get the element where you want to display the transactions
          const transactionsList = document.getElementById('latestTransactions');

          // Update the HTML content with the latest transactions
          latestTransactions.forEach(transaction => {
              const listItem = document.createElement('li');
              listItem.textContent = `Transaction ID: ${transaction.transaction_id}, Type: ${transaction.transaction_type}, Amount: $${transaction.transaction_price}`;
              transactionsList.appendChild(listItem);
          });

      } catch (error) {
          console.error('Error fetching latest transactions:', error);
      }
  }

  // Call the function to display the latest transactions on page load
  displayLatestTransactions();
</script>

<%- include ('../partials/footer') %>